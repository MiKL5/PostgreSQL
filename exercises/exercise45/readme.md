# **L’identité avec les tables** <a href="../../"> <img src="https://upload.wikimedia.org/wikipedia/commons/2/29/Postgresql_elephant.svg" alt="PostgreSQL" title="PostgreSQL" align="right" height="64px"> </a>
Deuis la version 10 PostgreSQL à intriduit la fonctionnalité ‘GENERATED AS IDENTITY’.  
Cette contrainte attribue automatiquement une valeur unique à une colonne.  
C’est utile pour les applications ayant besoin de gérer un autoincrément à une table pour retrouver la ligne lors d’une recharche.  
C’est pratique pour les performances et au niveau applicatif notament sur SQL Server qui intègre aussi cette fonctionnalité. On y ajoute souvent un index.  

Il y a trois types :
* SMALLINT ;
* INT ;
* BIGINT.
```sql
-- Créer une table avec cette fonctionnalité
CREATE TABLE couleur
(
	color_id INT GENERATED ALWAYS AS IDENTITY,
	color_name VARCHAR NOT NULL
);
-- Ajouter red
INSERT INTO couleur (color_name) VALUES ('red'); -- id 1
-- Ajouter 2 green
INSERT INTO couleur (color_id , color_name) VALUES (2 , green); -- ERROR:  La colonne « color_id » est une colonne d'identité définie comme GENERATED ALWAYS.ne peut pas insérer une valeur pas par défaut dans la colonne « color_id » 
-- Surcharger avec `OVERIDING SYSTEM VALUE`
INSERT INTO couleur (color_id , color_name)
	OVERRIDING SYSTEM VALUE
	VALUES (2 , 'green');

-- Générer une table avec `GENERATED BY DEFAULT AS IDENTITY`
CREATE TABLE IF NOT EXISTS color
(
	c_id INT GENERATED BY DEFAULT AS IDENTITY, -- permet de forcer une valeur
	c_name VARCHAR NOT NULL
);
-- Ajouter white
INSERT INTO color (c_name) VALUES ('white');
-- Ajouter 2 black
INSERT INTO color (c_id , c_name) VALUES (2 , 'black');

-- Créer une table permettant la modification du pas d'incrément pour démarrer à 10
CREATE TABLE IF NOT EXISTS color2
(
	c_id INT GENERATED BY DEFAULT AS IDENTITY
	(START WITH 10 INCREMENT BY 10), -- Depuis 10 et saut de 10
	c_name VARCHAR NOT NULL
);
INSERT INTO color2 (c_name) VALUES ('orange'); -- à 10
INSERT INTO color2 (c_name) VALUES ('purplə'); -- à 20
```